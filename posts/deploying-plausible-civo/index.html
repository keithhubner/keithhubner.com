<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Deploying Plausible to Civo Kubernetes | Keith Hubner</title>
<meta name=keywords content="Civo,Kubernetes"><meta name=description content="In this guide, we will walk you through the process of deploying Plausible Analytics to a Civo Kubernetes cluster. Plausible Analytics is a lightweight and open-source web analytics tool that prioritizes privacy and simplicity. By the end of this tutorial, you will have a fully functional Plausible Analytics instance running on your Civo Kubernetes cluster.
Prerequisites
Before you begin, ensure you have the following setup:

Civo Account: A Civo account with access to create Kubernetes clusters.
Civo CLI: The Civo CLI installed and configured on your local machine.
kubectl: The Kubernetes command-line tool installed and configured to interact with your cluster.
Helm: The Helm package manager installed on your local machine.
Domain Name: A domain name that you can use for your Plausible Analytics instance.
Email Address: An email address to use for Let&rsquo;s Encrypt SSL certificates.

With these prerequisites in place, you are ready to proceed with the deployment."><meta name=author content="Keith Hubner"><link rel=canonical href=https://blog.keithhubner.com/posts/deploying-plausible-civo/><link crossorigin=anonymous href=/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.keithhubner.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.keithhubner.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.keithhubner.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.keithhubner.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.keithhubner.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.keithhubner.com/posts/deploying-plausible-civo/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script defer data-domain=blog.keithhubner.com src=https://plausible.jankylabs.co.uk/js/script.js></script><meta property="og:url" content="https://blog.keithhubner.com/posts/deploying-plausible-civo/"><meta property="og:site_name" content="Keith Hubner"><meta property="og:title" content="Deploying Plausible to Civo Kubernetes"><meta property="og:description" content="In this guide, we will walk you through the process of deploying Plausible Analytics to a Civo Kubernetes cluster. Plausible Analytics is a lightweight and open-source web analytics tool that prioritizes privacy and simplicity. By the end of this tutorial, you will have a fully functional Plausible Analytics instance running on your Civo Kubernetes cluster.
Prerequisites Before you begin, ensure you have the following setup:
Civo Account: A Civo account with access to create Kubernetes clusters. Civo CLI: The Civo CLI installed and configured on your local machine. kubectl: The Kubernetes command-line tool installed and configured to interact with your cluster. Helm: The Helm package manager installed on your local machine. Domain Name: A domain name that you can use for your Plausible Analytics instance. Email Address: An email address to use for Let’s Encrypt SSL certificates. With these prerequisites in place, you are ready to proceed with the deployment."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-01-22T00:00:00+00:00"><meta property="article:modified_time" content="2025-01-22T00:00:00+00:00"><meta property="article:tag" content="Civo"><meta property="article:tag" content="Kubernetes"><meta name=twitter:card content="summary"><meta name=twitter:title content="Deploying Plausible to Civo Kubernetes"><meta name=twitter:description content="In this guide, we will walk you through the process of deploying Plausible Analytics to a Civo Kubernetes cluster. Plausible Analytics is a lightweight and open-source web analytics tool that prioritizes privacy and simplicity. By the end of this tutorial, you will have a fully functional Plausible Analytics instance running on your Civo Kubernetes cluster.
Prerequisites
Before you begin, ensure you have the following setup:

Civo Account: A Civo account with access to create Kubernetes clusters.
Civo CLI: The Civo CLI installed and configured on your local machine.
kubectl: The Kubernetes command-line tool installed and configured to interact with your cluster.
Helm: The Helm package manager installed on your local machine.
Domain Name: A domain name that you can use for your Plausible Analytics instance.
Email Address: An email address to use for Let&rsquo;s Encrypt SSL certificates.

With these prerequisites in place, you are ready to proceed with the deployment."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"All Posts","item":"https://blog.keithhubner.com/posts/"},{"@type":"ListItem","position":2,"name":"Deploying Plausible to Civo Kubernetes","item":"https://blog.keithhubner.com/posts/deploying-plausible-civo/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Deploying Plausible to Civo Kubernetes","name":"Deploying Plausible to Civo Kubernetes","description":"In this guide, we will walk you through the process of deploying Plausible Analytics to a Civo Kubernetes cluster. Plausible Analytics is a lightweight and open-source web analytics tool that prioritizes privacy and simplicity. By the end of this tutorial, you will have a fully functional Plausible Analytics instance running on your Civo Kubernetes cluster.\nPrerequisites Before you begin, ensure you have the following setup:\nCivo Account: A Civo account with access to create Kubernetes clusters. Civo CLI: The Civo CLI installed and configured on your local machine. kubectl: The Kubernetes command-line tool installed and configured to interact with your cluster. Helm: The Helm package manager installed on your local machine. Domain Name: A domain name that you can use for your Plausible Analytics instance. Email Address: An email address to use for Let\u0026rsquo;s Encrypt SSL certificates. With these prerequisites in place, you are ready to proceed with the deployment.\n","keywords":["Civo","Kubernetes"],"articleBody":"In this guide, we will walk you through the process of deploying Plausible Analytics to a Civo Kubernetes cluster. Plausible Analytics is a lightweight and open-source web analytics tool that prioritizes privacy and simplicity. By the end of this tutorial, you will have a fully functional Plausible Analytics instance running on your Civo Kubernetes cluster.\nPrerequisites Before you begin, ensure you have the following setup:\nCivo Account: A Civo account with access to create Kubernetes clusters. Civo CLI: The Civo CLI installed and configured on your local machine. kubectl: The Kubernetes command-line tool installed and configured to interact with your cluster. Helm: The Helm package manager installed on your local machine. Domain Name: A domain name that you can use for your Plausible Analytics instance. Email Address: An email address to use for Let’s Encrypt SSL certificates. With these prerequisites in place, you are ready to proceed with the deployment.\nCreate Cluster We will now use the Civo CLI to create the cluster, waiting for it to provion and automatically saving and merging the KUBECONFIG. You may want to review the Civo documentation for further information.\nYou can specify a name for the cluster after the create command:\ncivo k8s create my-cluster --nodes=3 --size=g4s.kube.medium --wait --save --merge Or leave this blank and one will be generated for you:\ncivo k8s create --nodes=3 --size=g4s.kube.medium --wait --save --merge Verify the cluster is up and running:\nkubectl get nodes Cert Manager Cert Manager is a Kubernetes add-on that automates the management and issuance of TLS certificates from various issuing sources. It ensures that certificates are valid and up-to-date, and it will attempt to renew certificates at an appropriate time before expiry. In this guide, we will use Cert Manager to handle the SSL certificates for our Plausible Analytics instance.\nhelm repo add jetstack https://charts.jetstack.io helm repo update helm install cert-manager jetstack/cert-manager \\ --namespace cert-manager \\ --create-namespace \\ --set installCRDs=true kubectl get pods --namespace cert-manager Setting Up the Project To get started, create a new folder for your project and open it in Visual Studio Code (VSCode). This will help you organize your files and make it easier to follow along with the tutorial.\nmkdir civo-plausible-demo cd civo-plausible-demo code . This will open the civo-plausible-demo folder in VSCode, where you can create and manage your Kubernetes manifests and other configuration files.\nCreating k8s manifests Creating Kubernetes manifests involves defining the desired state of your Kubernetes resources using YAML files. These manifests describe various aspects of your application, such as deployments, services, config maps, secrets, and persistent volume claims (PVCs). By applying these manifests to your Kubernetes cluster, you instruct Kubernetes to create and manage the resources accordingly. In this section, we will create the necessary Kubernetes manifests to deploy Plausible Analytics and its dependencies on your Civo Kubernetes cluster.\nCertificate Issuers Cert issuers are responsible for obtaining and managing SSL/TLS certificates for secure communication in your Kubernetes cluster.\nIssuers for staging and prod:\ncat \u003c\u003c'EOF' \u003e issuers.yaml apiVersion: cert-manager.io/v1 kind: ClusterIssuer metadata: name: letsencrypt-staging spec: acme: email: change@me.com server: https://acme-staging-v02.api.letsencrypt.org/directory privateKeySecretRef: name: letsencrypt-staging-key solvers: - http01: ingress: class: traefik --- apiVersion: cert-manager.io/v1 kind: ClusterIssuer metadata: name: letsencrypt-production spec: acme: email: change@me.com server: https://acme-v02.api.letsencrypt.org/directory privateKeySecretRef: name: letsencrypt-production-key solvers: - http01: ingress: class: traefik EOF You can then edit this newly created file and update the email address used by cert manager to your own.\nPlausible Deployment Namespace We will next create a namespace so plausible is segregated from other applications on the cluster.\ncat \u003c\u003c'EOF' \u003e namespace.yaml apiVersion: v1 kind: Namespace metadata: name: plausible EOF kubectl apply -f namespace.yaml Secret Next we will create the Kubernetes secret which will hold some values used by Plausible. As with any secret held in Kubernetes secrets, these are only base64 encoded and therefore is only really designed for simple deployments. It is worth considering an external secrets manager to provide better management of secrets, one simple and free secrets manager is Bitwarden Secrets Manager.\nBelow is an example of how to create your base64 encoded values:\necho -n \"plausible\" | base64 echo -n \"plausible_password\" | base64 echo -n \"plausible_db\" | base64 echo -n \"postgres://plausible:plausible_password@plausible-postgres:5432/plausible_db\" | base64 We can then create and update the relevant values with those generated above:\ncat \u003c\u003c'EOF' \u003e secret.yaml apiVersion: v1 kind: Secret metadata: name: plausible-config namespace: plausible type: Opaque data: POSTGRES_USER: cGxhdXNpYmxl # base64 of \"plausible\" POSTGRES_PASSWORD: cGxhdXNpYmxlX3Bhc3N3b3Jk # base64 of \"plausible_password\" POSTGRES_DB: cGxhdXNpYmxlX2Ri # base64 of \"plausible_db\" DATABASE_URL: cG9zdGdyZXM6Ly9wbGF1c2libGU6cGxhdXNpYmxlX3Bhc3N3b3JkQHBsYXVzaWJsZS1wb3N0Z3Jlc3FsOjU0MzIvcGxhdXNpYmxlX2Ri # base64 of \"postgres://plausible:plausible_password@plausible-postgres:5432/plausible_db\" EOF ConfigMap Next we create the config map with the relevant values, again replace with your domain etc. You will need to generate a random SECRET_KEY_BASE, which you can do by:\nopenssl rand -base64 48 We can then create the config map and alter the values including the generated key to use as the SECRET_KEY_BASE.\nWhen deploying a cluster to Civo, you are automatically allocated a DNS record for your cluster. If you don’t have a domain you can use this.\nYou can find this value by using the civo cli:\nList out your clusters:\ncivo k3s ls Use the cluster name to find the DNS record:\ncivo k3s show crimson-darkness-b519665c | grep \"DNS A record\" We can then use this, or your actual DNS record, when creating the config for Plausible:\nI will be using my example value in this demo later when we create the ingress so make sure you replace this with your own.\ncat \u003c\u003c'EOF' \u003e configMap.yaml apiVersion: v1 kind: ConfigMap metadata: name: plausible-configmap namespace: plausible data: BASE_URL: \"https://6c01f85b-7f17-4fa6-bc59-1a6c16f1576d.k8s.civo.com\" SECRET_KEY_BASE: \"bUxqWWdaSmQ3cjdkQXpqdmpTTE5CMldIZ1pXWlNZc2ZBU3dxRFpnV3o1UWpOUk9MS2hUR2F1U1Q1RUVKRjFScQo=\" CLICKHOUSE_DATABASE_URL: \"http://plausible-clickhouse:8123/plausible_events_db\" EOF Creating PVCs Plausible and the supporting applications require persistant storage, next we will create this storage. In this demo we are using postgres and clickhouse services inside the cluster, if you are deploying at scale you may wish to look at external services.\ncat \u003c\u003c'EOF' \u003e pvcs.yaml apiVersion: v1 kind: PersistentVolumeClaim metadata: name: postgres-pvc namespace: plausible spec: accessModes: - ReadWriteOnce resources: requests: storage: 10Gi --- apiVersion: v1 kind: PersistentVolumeClaim metadata: name: clickhouse-pvc namespace: plausible spec: accessModes: - ReadWriteOnce resources: requests: storage: 10Gi EOF Postgres As mentioned previously you can use an external postgres database, for example a Civo managed db. For the purpose of this demo, we will keep things simple and deploy postgres into the cluster.\ncat \u003c\u003c'EOF' \u003e postgres.yaml apiVersion: apps/v1 kind: Deployment metadata: name: plausible-postgresql namespace: plausible spec: replicas: 1 selector: matchLabels: app: plausible-postgresql template: metadata: labels: app: plausible-postgresql spec: containers: - name: postgresql image: postgres:14 ports: - containerPort: 5432 env: - name: POSTGRES_USER valueFrom: secretKeyRef: name: plausible-config key: POSTGRES_USER - name: POSTGRES_PASSWORD valueFrom: secretKeyRef: name: plausible-config key: POSTGRES_PASSWORD - name: POSTGRES_DB valueFrom: secretKeyRef: name: plausible-config key: POSTGRES_DB - name: PGDATA value: /var/lib/postgresql/data/pgdata volumeMounts: - mountPath: /var/lib/postgresql/data name: postgres-data volumes: - name: postgres-data persistentVolumeClaim: claimName: postgres-pvc EOF Clickhouse deployment Plausible Analytics uses ClickHouse as its primary database for storing and querying analytics data. ClickHouse is a columnar database management system known for its high performance and efficiency in handling large volumes of data. It is optimized for read-heavy operations, making it ideal for real-time analytics and reporting. By leveraging ClickHouse, Plausible can provide fast and accurate insights into website traffic and user behavior, ensuring a smooth and responsive experience for its users.\ncat \u003c\u003c'EOF' \u003e clickhouse.yaml apiVersion: apps/v1 kind: Deployment metadata: name: plausible-clickhouse namespace: plausible spec: replicas: 1 selector: matchLabels: app: plausible-clickhouse template: metadata: labels: app: plausible-clickhouse spec: containers: - name: clickhouse image: clickhouse/clickhouse-server:24.3.3.102-alpine ports: - containerPort: 8123 volumeMounts: - mountPath: /var/lib/clickhouse name: clickhouse-data volumes: - name: clickhouse-data persistentVolumeClaim: claimName: clickhouse-pvc EOF Simple Mail Server cat \u003c\u003c'EOF' \u003e mail.yaml apiVersion: apps/v1 kind: Deployment metadata: name: plausible-mail namespace: plausible spec: replicas: 1 selector: matchLabels: app: plausible-mail template: metadata: labels: app: plausible-mail spec: containers: - name: mail image: bytemark/smtp ports: - containerPort: 25 EOF The Plausible Application Deployment And finally we get to the actual deployment of Plausible:\ncat \u003c\u003c'EOF' \u003e deployment.yaml apiVersion: apps/v1 kind: Deployment metadata: name: plausible namespace: plausible spec: replicas: 1 selector: matchLabels: app: plausible template: metadata: labels: app: plausible spec: initContainers: - name: wait-for-postgresql image: busybox command: ['sh', '-c', 'until nc -z plausible-postgresql 5432; do echo \"Waiting for PostgreSQL...\"; sleep 2; done'] containers: - name: plausible image: ghcr.io/plausible/community-edition:v2.1.4 command: [\"/bin/sh\", \"-c\", \"/entrypoint.sh db createdb \u0026\u0026 /entrypoint.sh db migrate \u0026\u0026 /entrypoint.sh run\"] ports: - containerPort: 8000 envFrom: - secretRef: name: plausible-config - configMapRef: name: plausible-configmap EOF Services for Postgres, Clickhouse, Plausible and Mail cat \u003c\u003c'EOF' \u003e services.yaml apiVersion: v1 kind: Service metadata: name: plausible-postgresql namespace: plausible spec: ports: - port: 5432 targetPort: 5432 selector: app: plausible-postgresql --- apiVersion: v1 kind: Service metadata: name: plausible-clickhouse namespace: plausible spec: ports: - port: 8123 targetPort: 8123 selector: app: plausible-clickhouse --- apiVersion: v1 kind: Service metadata: name: plausible-mail namespace: plausible spec: ports: - port: 25 targetPort: 25 selector: app: plausible-mail --- apiVersion: v1 kind: Service metadata: name: plausible namespace: plausible spec: ports: - port: 80 targetPort: 8000 selector: app: plausible EOF Ingress Lastly we can deploy the ingress. As you will see we have commented out the production issuer until the domain is ready.\nAs mentioned earlier, here I am using the example DNS record for the cluster, you will need to update this with your own.\ncat \u003c\u003c'EOF' \u003e ingress.yaml apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: plausible-ingress namespace: plausible annotations: cert-manager.io/cluster-issuer: letsencrypt-staging traefik.ingress.kubernetes.io/redirect-scheme: https traefik.ingress.kubernetes.io/redirect-permanent: \"true\" spec: rules: - host: 6c01f85b-7f17-4fa6-bc59-1a6c16f1576d.k8s.civo.com http: paths: - path: / pathType: Prefix backend: service: name: plausible port: number: 80 tls: - hosts: - 6c01f85b-7f17-4fa6-bc59-1a6c16f1576d.k8s.civo.com secretName: plausible-tls EOF Deploying Now we have all the files created, we can now easily deploy the application:\nFirst we need to create the namespace:\nkubectl apply -f namespace.yaml Then with this created all the remaining resources:\nkubectl apply -f . You can review the status of everything in the namespace:\nGive this a few minutes, maybe make a ☕️\nkubectl get all -n plausible Then we should be able to access and URL and setup Plausible!\nDon’t forget when you are happy the DNS is working you can update the ingress to use the production cert:\nkubectl annotate ingress plausible-ingress -n plausible \\ cert-manager.io/cluster-issuer=letsencrypt-production --overwrite Hope you enjoyed working through this guide!\n","wordCount":"1673","inLanguage":"en","datePublished":"2025-01-22T00:00:00Z","dateModified":"2025-01-22T00:00:00Z","author":{"@type":"Person","name":"Keith Hubner"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.keithhubner.com/posts/deploying-plausible-civo/"},"publisher":{"@type":"Organization","name":"Keith Hubner","logo":{"@type":"ImageObject","url":"https://blog.keithhubner.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.keithhubner.com/ accesskey=h title="Keith Hubner (Alt + H)">Keith Hubner</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.keithhubner.com/ title=Home><span>Home</span></a></li><li><a href=https://blog.keithhubner.com/about/ title="About Me"><span>About Me</span></a></li><li><a href=https://blog.keithhubner.com/posts/ title=Blog><span>Blog</span></a></li><li><a href=https://blog.keithhubner.com/contact/ title=Contact><span>Contact</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Deploying Plausible to Civo Kubernetes</h1><div class=post-meta><span title='2025-01-22 00:00:00 +0000 UTC'>January 22, 2025</span>&nbsp;·&nbsp;Keith Hubner</div></header><div class=post-content><p>In this guide, we will walk you through the process of deploying Plausible Analytics to a Civo Kubernetes cluster. Plausible Analytics is a lightweight and open-source web analytics tool that prioritizes privacy and simplicity. By the end of this tutorial, you will have a fully functional Plausible Analytics instance running on your Civo Kubernetes cluster.</p><h2 id=prerequisites>Prerequisites<a hidden class=anchor aria-hidden=true href=#prerequisites>#</a></h2><p>Before you begin, ensure you have the following setup:</p><ol><li><strong>Civo Account</strong>: A <a href=https://www.civo.com/signup>Civo account</a> with access to create Kubernetes clusters.</li><li><strong>Civo CLI</strong>: The <a href=https://www.civo.com/docs/cli>Civo CLI</a> installed and configured on your local machine.</li><li><strong>kubectl</strong>: The <a href=https://kubernetes.io/docs/tasks/tools/>Kubernetes command-line tool</a> installed and configured to interact with your cluster.</li><li><strong>Helm</strong>: The <a href=https://helm.sh/docs/intro/install/>Helm package manager</a> installed on your local machine.</li><li><strong>Domain Name</strong>: A domain name that you can use for your Plausible Analytics instance.</li><li><strong>Email Address</strong>: An email address to use for Let&rsquo;s Encrypt SSL certificates.</li></ol><p>With these prerequisites in place, you are ready to proceed with the deployment.</p><h2 id=create-cluster>Create Cluster<a hidden class=anchor aria-hidden=true href=#create-cluster>#</a></h2><p>We will now use the Civo CLI to create the cluster, waiting for it to provion and automatically saving and merging the KUBECONFIG. You may want to review the Civo documentation for further information.</p><blockquote><p>You can specify a name for the cluster after the create command:</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>civo k8s create my-cluster --nodes<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> --size<span style=color:#f92672>=</span>g4s.kube.medium --wait --save --merge
</span></span></code></pre></div><p>Or leave this blank and one will be generated for you:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>civo k8s create --nodes<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> --size<span style=color:#f92672>=</span>g4s.kube.medium --wait --save --merge
</span></span></code></pre></div><p>Verify the cluster is up and running:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get nodes
</span></span></code></pre></div><h2 id=cert-manager>Cert Manager<a hidden class=anchor aria-hidden=true href=#cert-manager>#</a></h2><p>Cert Manager is a Kubernetes add-on that automates the management and issuance of TLS certificates from various issuing sources. It ensures that certificates are valid and up-to-date, and it will attempt to renew certificates at an appropriate time before expiry. In this guide, we will use Cert Manager to handle the SSL certificates for our Plausible Analytics instance.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo add jetstack https://charts.jetstack.io
</span></span><span style=display:flex><span>helm repo update
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install cert-manager jetstack/cert-manager <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --namespace cert-manager <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --create-namespace <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --set installCRDs<span style=color:#f92672>=</span>true
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pods --namespace cert-manager
</span></span></code></pre></div><h2 id=setting-up-the-project>Setting Up the Project<a hidden class=anchor aria-hidden=true href=#setting-up-the-project>#</a></h2><p>To get started, create a new folder for your project and open it in Visual Studio Code (VSCode). This will help you organize your files and make it easier to follow along with the tutorial.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir civo-plausible-demo
</span></span><span style=display:flex><span>cd civo-plausible-demo
</span></span><span style=display:flex><span>code .
</span></span></code></pre></div><p>This will open the <code>civo-plausible-demo</code> folder in VSCode, where you can create and manage your Kubernetes manifests and other configuration files.</p><h2 id=creating-k8s-manifests>Creating k8s manifests<a hidden class=anchor aria-hidden=true href=#creating-k8s-manifests>#</a></h2><p>Creating Kubernetes manifests involves defining the desired state of your Kubernetes resources using YAML files. These manifests describe various aspects of your application, such as deployments, services, config maps, secrets, and persistent volume claims (PVCs). By applying these manifests to your Kubernetes cluster, you instruct Kubernetes to create and manage the resources accordingly. In this section, we will create the necessary Kubernetes manifests to deploy Plausible Analytics and its dependencies on your Civo Kubernetes cluster.</p><h3 id=certificate-issuers>Certificate Issuers<a hidden class=anchor aria-hidden=true href=#certificate-issuers>#</a></h3><p>Cert issuers are responsible for obtaining and managing SSL/TLS certificates for secure communication in your Kubernetes cluster.</p><p>Issuers for staging and prod:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;&#39;EOF&#39; &gt; issuers.yaml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: cert-manager.io/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: ClusterIssuer
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: letsencrypt-staging
</span></span></span><span style=display:flex><span><span style=color:#e6db74>spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  acme:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    email: change@me.com
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    server: https://acme-staging-v02.api.letsencrypt.org/directory
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    privateKeySecretRef:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      name: letsencrypt-staging-key
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    solvers:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - http01:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ingress:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          class: traefik
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: cert-manager.io/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: ClusterIssuer
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: letsencrypt-production
</span></span></span><span style=display:flex><span><span style=color:#e6db74>spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  acme:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    email: change@me.com
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    server: https://acme-v02.api.letsencrypt.org/directory
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    privateKeySecretRef:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      name: letsencrypt-production-key
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    solvers:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - http01:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ingress:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          class: traefik
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><p>You can then edit this newly created file and update the email address used by cert manager to your own.</p><h2 id=plausible-deployment>Plausible Deployment<a hidden class=anchor aria-hidden=true href=#plausible-deployment>#</a></h2><h3 id=namespace>Namespace<a hidden class=anchor aria-hidden=true href=#namespace>#</a></h3><p>We will next create a namespace so plausible is segregated from other applications on the cluster.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;&#39;EOF&#39; &gt; namespace.yaml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: Namespace
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: plausible
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f namespace.yaml
</span></span></code></pre></div><h3 id=secret>Secret<a hidden class=anchor aria-hidden=true href=#secret>#</a></h3><p>Next we will create the Kubernetes secret which will hold some values used by Plausible. As with any secret held in Kubernetes secrets, these are only base64 encoded and therefore is only really designed for simple deployments. It is worth considering an external secrets manager to provide better management of secrets, one simple and free secrets manager is <a href=https://bitwarden.com/help/secrets-manager-quick-start/>Bitwarden Secrets Manager</a>.</p><p>Below is an example of how to create your base64 encoded values:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo -n <span style=color:#e6db74>&#34;plausible&#34;</span> | base64
</span></span><span style=display:flex><span>echo -n <span style=color:#e6db74>&#34;plausible_password&#34;</span> | base64
</span></span><span style=display:flex><span>echo -n <span style=color:#e6db74>&#34;plausible_db&#34;</span> | base64
</span></span><span style=display:flex><span>echo -n <span style=color:#e6db74>&#34;postgres://plausible:plausible_password@plausible-postgres:5432/plausible_db&#34;</span> | base64
</span></span></code></pre></div><p>We can then create and update the relevant values with those generated above:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ae81ff>cat &lt;&lt;&#39;EOF&#39; &gt; secret.yaml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Secret</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>plausible-config</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>plausible</span>
</span></span><span style=display:flex><span><span style=color:#f92672>type</span>: <span style=color:#ae81ff>Opaque</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>POSTGRES_USER</span>: <span style=color:#ae81ff>cGxhdXNpYmxl</span> <span style=color:#75715e># base64 of &#34;plausible&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>POSTGRES_PASSWORD</span>: <span style=color:#ae81ff>cGxhdXNpYmxlX3Bhc3N3b3Jk</span> <span style=color:#75715e># base64 of &#34;plausible_password&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>POSTGRES_DB</span>: <span style=color:#ae81ff>cGxhdXNpYmxlX2Ri</span> <span style=color:#75715e># base64 of &#34;plausible_db&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>DATABASE_URL</span>: <span style=color:#ae81ff>cG9zdGdyZXM6Ly9wbGF1c2libGU6cGxhdXNpYmxlX3Bhc3N3b3JkQHBsYXVzaWJsZS1wb3N0Z3Jlc3FsOjU0MzIvcGxhdXNpYmxlX2Ri</span> <span style=color:#75715e># base64 of &#34;postgres://plausible:plausible_password@plausible-postgres:5432/plausible_db&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>EOF</span>
</span></span></code></pre></div><h3 id=configmap>ConfigMap<a hidden class=anchor aria-hidden=true href=#configmap>#</a></h3><p>Next we create the config map with the relevant values, again replace with your domain etc. You will need to generate a random SECRET_KEY_BASE, which you can do by:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>openssl rand -base64 <span style=color:#ae81ff>48</span>
</span></span></code></pre></div><p>We can then create the config map and alter the values including the generated key to use as the SECRET_KEY_BASE.</p><p>When deploying a cluster to Civo, you are automatically allocated a DNS record for your cluster. If you don&rsquo;t have a domain you can use this.</p><p>You can find this value by using the civo cli:</p><p>List out your clusters:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>civo k3s ls
</span></span></code></pre></div><p>Use the cluster name to find the DNS record:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>civo k3s show crimson-darkness-b519665c | grep <span style=color:#e6db74>&#34;DNS A record&#34;</span>
</span></span></code></pre></div><p>We can then use this, or your actual DNS record, when creating the config for Plausible:</p><blockquote><p>I will be using my example value in this demo later when we create the ingress so make sure you replace this with your own.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;&#39;EOF&#39; &gt; configMap.yaml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: ConfigMap
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: plausible-configmap
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  namespace: plausible
</span></span></span><span style=display:flex><span><span style=color:#e6db74>data:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  BASE_URL: &#34;https://6c01f85b-7f17-4fa6-bc59-1a6c16f1576d.k8s.civo.com&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  SECRET_KEY_BASE: &#34;bUxqWWdaSmQ3cjdkQXpqdmpTTE5CMldIZ1pXWlNZc2ZBU3dxRFpnV3o1UWpOUk9MS2hUR2F1U1Q1RUVKRjFScQo=&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  CLICKHOUSE_DATABASE_URL: &#34;http://plausible-clickhouse:8123/plausible_events_db&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><h3 id=creating-pvcs>Creating PVCs<a hidden class=anchor aria-hidden=true href=#creating-pvcs>#</a></h3><p>Plausible and the supporting applications require persistant storage, next we will create this storage. In this demo we are using postgres and clickhouse services inside the cluster, if you are deploying at scale you may wish to look at external services.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;&#39;EOF&#39; &gt; pvcs.yaml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: PersistentVolumeClaim
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: postgres-pvc
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  namespace: plausible
</span></span></span><span style=display:flex><span><span style=color:#e6db74>spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  accessModes:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - ReadWriteOnce
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  resources:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    requests:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      storage: 10Gi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: PersistentVolumeClaim
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: clickhouse-pvc
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  namespace: plausible
</span></span></span><span style=display:flex><span><span style=color:#e6db74>spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  accessModes:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - ReadWriteOnce
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  resources:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    requests:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      storage: 10Gi
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><h3 id=postgres>Postgres<a hidden class=anchor aria-hidden=true href=#postgres>#</a></h3><p>As mentioned previously you can use an external postgres database, for example a <a href=https://www.civo.com/docs/database/postgresql>Civo managed db</a>. For the purpose of this demo, we will keep things simple and deploy postgres into the cluster.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;&#39;EOF&#39; &gt; postgres.yaml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: apps/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: Deployment
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: plausible-postgresql
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  namespace: plausible
</span></span></span><span style=display:flex><span><span style=color:#e6db74>spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  replicas: 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  selector:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      app: plausible-postgresql
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  template:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      labels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        app: plausible-postgresql
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      containers:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - name: postgresql
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        image: postgres:14
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ports:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - containerPort: 5432
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        env:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - name: POSTGRES_USER
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          valueFrom:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            secretKeyRef:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              name: plausible-config
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              key: POSTGRES_USER
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - name: POSTGRES_PASSWORD
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          valueFrom:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            secretKeyRef:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              name: plausible-config
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              key: POSTGRES_PASSWORD
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - name: POSTGRES_DB
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          valueFrom:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            secretKeyRef:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              name: plausible-config
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              key: POSTGRES_DB
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - name: PGDATA
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          value: /var/lib/postgresql/data/pgdata
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        volumeMounts:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - mountPath: /var/lib/postgresql/data
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          name: postgres-data
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      volumes:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - name: postgres-data
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        persistentVolumeClaim:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          claimName: postgres-pvc
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><h3 id=clickhouse-deployment>Clickhouse deployment<a hidden class=anchor aria-hidden=true href=#clickhouse-deployment>#</a></h3><p>Plausible Analytics uses ClickHouse as its primary database for storing and querying analytics data. ClickHouse is a columnar database management system known for its high performance and efficiency in handling large volumes of data. It is optimized for read-heavy operations, making it ideal for real-time analytics and reporting. By leveraging ClickHouse, Plausible can provide fast and accurate insights into website traffic and user behavior, ensuring a smooth and responsive experience for its users.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;&#39;EOF&#39; &gt; clickhouse.yaml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: apps/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: Deployment
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: plausible-clickhouse
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  namespace: plausible
</span></span></span><span style=display:flex><span><span style=color:#e6db74>spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  replicas: 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  selector:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      app: plausible-clickhouse
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  template:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      labels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        app: plausible-clickhouse
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      containers:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - name: clickhouse
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        image: clickhouse/clickhouse-server:24.3.3.102-alpine
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ports:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - containerPort: 8123
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        volumeMounts:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - mountPath: /var/lib/clickhouse
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          name: clickhouse-data
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      volumes:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - name: clickhouse-data
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        persistentVolumeClaim:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          claimName: clickhouse-pvc
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><h3 id=simple-mail-server>Simple Mail Server<a hidden class=anchor aria-hidden=true href=#simple-mail-server>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;&#39;EOF&#39; &gt; mail.yaml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: apps/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: Deployment
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: plausible-mail
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  namespace: plausible
</span></span></span><span style=display:flex><span><span style=color:#e6db74>spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  replicas: 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  selector:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      app: plausible-mail
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  template:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      labels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        app: plausible-mail
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      containers:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - name: mail
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        image: bytemark/smtp
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ports:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - containerPort: 25
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><h3 id=the-plausible-application-deployment>The Plausible Application Deployment<a hidden class=anchor aria-hidden=true href=#the-plausible-application-deployment>#</a></h3><p>And finally we get to the actual deployment of Plausible:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;&#39;EOF&#39; &gt; deployment.yaml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: apps/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: Deployment
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: plausible
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  namespace: plausible
</span></span></span><span style=display:flex><span><span style=color:#e6db74>spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  replicas: 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  selector:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    matchLabels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      app: plausible
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  template:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      labels:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        app: plausible
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      initContainers:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - name: wait-for-postgresql
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        image: busybox
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        command: [&#39;sh&#39;, &#39;-c&#39;, &#39;until nc -z plausible-postgresql 5432; do echo &#34;Waiting for PostgreSQL...&#34;; sleep 2; done&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      containers:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - name: plausible
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        image: ghcr.io/plausible/community-edition:v2.1.4
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        command: [&#34;/bin/sh&#34;, &#34;-c&#34;, &#34;/entrypoint.sh db createdb &amp;&amp; /entrypoint.sh db migrate &amp;&amp; /entrypoint.sh run&#34;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ports:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - containerPort: 8000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        envFrom:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - secretRef:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            name: plausible-config
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - configMapRef:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            name: plausible-configmap
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><h3 id=services-for-postgres-clickhouse-plausible-and-mail>Services for Postgres, Clickhouse, Plausible and Mail<a hidden class=anchor aria-hidden=true href=#services-for-postgres-clickhouse-plausible-and-mail>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;&#39;EOF&#39; &gt; services.yaml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: Service
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: plausible-postgresql
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  namespace: plausible
</span></span></span><span style=display:flex><span><span style=color:#e6db74>spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ports:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - port: 5432
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    targetPort: 5432
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  selector:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    app: plausible-postgresql
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: Service
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: plausible-clickhouse
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  namespace: plausible
</span></span></span><span style=display:flex><span><span style=color:#e6db74>spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ports:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - port: 8123
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    targetPort: 8123
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  selector:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    app: plausible-clickhouse
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: Service
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: plausible-mail
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  namespace: plausible
</span></span></span><span style=display:flex><span><span style=color:#e6db74>spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ports:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - port: 25
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    targetPort: 25
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  selector:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    app: plausible-mail
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: Service
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: plausible
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  namespace: plausible
</span></span></span><span style=display:flex><span><span style=color:#e6db74>spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ports:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - port: 80
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    targetPort: 8000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  selector:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    app: plausible
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><h3 id=ingress>Ingress<a hidden class=anchor aria-hidden=true href=#ingress>#</a></h3><p>Lastly we can deploy the ingress. As you will see we have commented out the production issuer until the domain is ready.</p><blockquote><p>As mentioned earlier, here I am using the example DNS record for the cluster, you will need to update this with your own.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#e6db74>&lt;&lt;&#39;EOF&#39; &gt; ingress.yaml
</span></span></span><span style=display:flex><span><span style=color:#e6db74>apiVersion: networking.k8s.io/v1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>kind: Ingress
</span></span></span><span style=display:flex><span><span style=color:#e6db74>metadata:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  name: plausible-ingress
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  namespace: plausible
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  annotations:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    cert-manager.io/cluster-issuer: letsencrypt-staging
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    traefik.ingress.kubernetes.io/redirect-scheme: https
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    traefik.ingress.kubernetes.io/redirect-permanent: &#34;true&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>spec:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  rules:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - host: 6c01f85b-7f17-4fa6-bc59-1a6c16f1576d.k8s.civo.com
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    http:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      paths:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - path: /
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        pathType: Prefix
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        backend:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          service:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            name: plausible
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            port:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              number: 80
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  tls:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  - hosts:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - 6c01f85b-7f17-4fa6-bc59-1a6c16f1576d.k8s.civo.com
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    secretName: plausible-tls
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><h2 id=deploying>Deploying<a hidden class=anchor aria-hidden=true href=#deploying>#</a></h2><p>Now we have all the files created, we can now easily deploy the application:</p><p>First we need to create the namespace:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f namespace.yaml
</span></span></code></pre></div><p>Then with this created all the remaining resources:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f .
</span></span></code></pre></div><p>You can review the status of everything in the namespace:</p><blockquote><p>Give this a few minutes, maybe make a ☕️</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get all -n plausible
</span></span></code></pre></div><p>Then we should be able to access and URL and setup Plausible!</p><blockquote><p>Don&rsquo;t forget when you are happy the DNS is working you can update the ingress to use the production cert:</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl annotate ingress plausible-ingress -n plausible <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  cert-manager.io/cluster-issuer<span style=color:#f92672>=</span>letsencrypt-production --overwrite
</span></span></code></pre></div><p>Hope you enjoyed working through this guide!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.keithhubner.com/tags/civo/>Civo</a></li><li><a href=https://blog.keithhubner.com/tags/kubernetes/>Kubernetes</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://blog.keithhubner.com/>Keith Hubner</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span><p>Get in touch:</p><ul><li><a href=mailto:yourname@example.com>Email</a></li><li><a href=https://linkedin.com/in/yourprofile>LinkedIn</a></li><li><a href=https://github.com/yourusername>GitHub</a></li></ul></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>