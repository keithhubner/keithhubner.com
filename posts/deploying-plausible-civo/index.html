<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Deploying Plausible to Civo NEW | Keith Hubner</title>
<meta name=keywords content="Civo,Kubernetes"><meta name=description content="Create Cluster:

You can specify a name for the cluster after the create command or leave this blank and one will be generated for you.


Please amend the node number and size to suit your requirements.

civo k8s create my-cluster --nodes=3 --size=g4s.kube.medium --wait --save --merge
civo k8s create --nodes=3 --size=g4s.kube.medium --wait --save --merge
Create namespace
kubectl create namespace plausible
Verify
kubectl get nodes
Cert Manager:
helm repo add jetstack https://charts.jetstack.io
helm repo update
helm install cert-manager jetstack/cert-manager \
  --namespace cert-manager \
  --create-namespace \
  --set installCRDs=true
kubectl get pods --namespace cert-manager
Issuers for staging and prod:"><meta name=author content="Keith Hubner"><link rel=canonical href=https://www.keithhubner.com/posts/deploying-plausible-civo/><link crossorigin=anonymous href=/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as=style><link rel=icon href=https://www.keithhubner.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.keithhubner.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.keithhubner.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.keithhubner.com/apple-touch-icon.png><link rel=mask-icon href=https://www.keithhubner.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.keithhubner.com/posts/deploying-plausible-civo/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://www.keithhubner.com/posts/deploying-plausible-civo/"><meta property="og:site_name" content="Keith Hubner"><meta property="og:title" content="Deploying Plausible to Civo NEW"><meta property="og:description" content="Create Cluster:
You can specify a name for the cluster after the create command or leave this blank and one will be generated for you.
Please amend the node number and size to suit your requirements.
civo k8s create my-cluster --nodes=3 --size=g4s.kube.medium --wait --save --merge civo k8s create --nodes=3 --size=g4s.kube.medium --wait --save --merge Create namespace
kubectl create namespace plausible Verify
kubectl get nodes Cert Manager:
helm repo add jetstack https://charts.jetstack.io helm repo update helm install cert-manager jetstack/cert-manager \ --namespace cert-manager \ --create-namespace \ --set installCRDs=true kubectl get pods --namespace cert-manager Issuers for staging and prod:"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-01-22T00:00:00+00:00"><meta property="article:modified_time" content="2025-01-22T00:00:00+00:00"><meta property="article:tag" content="Civo"><meta property="article:tag" content="Kubernetes"><meta name=twitter:card content="summary"><meta name=twitter:title content="Deploying Plausible to Civo NEW"><meta name=twitter:description content="Create Cluster:

You can specify a name for the cluster after the create command or leave this blank and one will be generated for you.


Please amend the node number and size to suit your requirements.

civo k8s create my-cluster --nodes=3 --size=g4s.kube.medium --wait --save --merge
civo k8s create --nodes=3 --size=g4s.kube.medium --wait --save --merge
Create namespace
kubectl create namespace plausible
Verify
kubectl get nodes
Cert Manager:
helm repo add jetstack https://charts.jetstack.io
helm repo update
helm install cert-manager jetstack/cert-manager \
  --namespace cert-manager \
  --create-namespace \
  --set installCRDs=true
kubectl get pods --namespace cert-manager
Issuers for staging and prod:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"All Posts","item":"https://www.keithhubner.com/posts/"},{"@type":"ListItem","position":2,"name":"Deploying Plausible to Civo NEW","item":"https://www.keithhubner.com/posts/deploying-plausible-civo/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Deploying Plausible to Civo NEW","name":"Deploying Plausible to Civo NEW","description":"Create Cluster:\nYou can specify a name for the cluster after the create command or leave this blank and one will be generated for you.\nPlease amend the node number and size to suit your requirements.\ncivo k8s create my-cluster --nodes=3 --size=g4s.kube.medium --wait --save --merge civo k8s create --nodes=3 --size=g4s.kube.medium --wait --save --merge Create namespace\nkubectl create namespace plausible Verify\nkubectl get nodes Cert Manager:\nhelm repo add jetstack https://charts.jetstack.io helm repo update helm install cert-manager jetstack/cert-manager \\ --namespace cert-manager \\ --create-namespace \\ --set installCRDs=true kubectl get pods --namespace cert-manager Issuers for staging and prod:\n","keywords":["Civo","Kubernetes"],"articleBody":"Create Cluster:\nYou can specify a name for the cluster after the create command or leave this blank and one will be generated for you.\nPlease amend the node number and size to suit your requirements.\ncivo k8s create my-cluster --nodes=3 --size=g4s.kube.medium --wait --save --merge civo k8s create --nodes=3 --size=g4s.kube.medium --wait --save --merge Create namespace\nkubectl create namespace plausible Verify\nkubectl get nodes Cert Manager:\nhelm repo add jetstack https://charts.jetstack.io helm repo update helm install cert-manager jetstack/cert-manager \\ --namespace cert-manager \\ --create-namespace \\ --set installCRDs=true kubectl get pods --namespace cert-manager Issuers for staging and prod:\napiVersion: cert-manager.io/v1 kind: ClusterIssuer metadata: name: letsencrypt-staging spec: acme: email: your-email@example.com server: https://acme-staging-v02.api.letsencrypt.org/directory privateKeySecretRef: name: letsencrypt-staging-key solvers: - http01: ingress: class: traefik --- apiVersion: cert-manager.io/v1 kind: ClusterIssuer metadata: name: letsencrypt-production spec: acme: # Change this to your email address email: your-email@example.com server: https://acme-v02.api.letsencrypt.org/directory privateKeySecretRef: # Secret used to store the account's private key name: letsencrypt-production-key solvers: - http01: ingress: class: traefik kubectl apply -f issuer.yaml Deployment Namespace apiVersion: v1 kind: Namespace metadata: name: plausible Secret As you can see below, some examples are given, you will need to replace these with your own values. Ensure these are base64 encoded.\napiVersion: v1 kind: Secret metadata: name: plausible-config namespace: plausible type: Opaque data: POSTGRES_USER: cGxhdXNpYmxl # base64 of \"plausible\" POSTGRES_PASSWORD: cGxhdXNpYmxlX3Bhc3N3b3Jk # base64 of \"plausible_password\" POSTGRES_DB: cGxhdXNpYmxlX2Ri # base64 of \"plausible_db\" DATABASE_URL: cG9zdGdyZXM6Ly9wbGF1c2libGU6cGxhdXNpYmxlX3Bhc3N3b3JkQHBsYXVzaWJsZS1wb3N0Z3Jlc3FsOjU0MzIvcGxhdXNpYmxlX2Ri # base64 of \"postgres://plausible:plausible_password@plausible-postgres:5432/plausible_db\" ConfigMap Next we create the config map with the relevant values, again replace with your domain etc. You will need to generate a random SECRET_KEY_BASE, which you can do by:\nopenssl rand -base64 48 Use the generated value and your domain value below:\n--- apiVersion: v1 kind: ConfigMap metadata: name: plausible-configmap namespace: plausible data: BASE_URL: \"https://YOUR_DOMAIN\" SECRET_KEY_BASE: \"GENERATED KEY\" CLICKHOUSE_DATABASE_URL: \"http://plausible-clickhouse:8123/plausible_events_db\" Creating PVCs apiVersion: v1 kind: PersistentVolumeClaim metadata: name: postgres-pvc namespace: plausible spec: accessModes: - ReadWriteOnce resources: requests: storage: 10Gi --- apiVersion: v1 kind: PersistentVolumeClaim metadata: name: clickhouse-pvc namespace: plausible spec: accessModes: - ReadWriteOnce resources: requests: storage: 10Gi Postgres You can of course use an external postgres database, for example a Civo managed db, but for this example we will deploy a database pod.\napiVersion: apps/v1 kind: Deployment metadata: name: plausible-postgresql namespace: plausible spec: replicas: 1 selector: matchLabels: app: plausible-postgresql template: metadata: labels: app: plausible-postgresql spec: containers: - name: postgresql image: postgres:14 ports: - containerPort: 5432 env: - name: POSTGRES_USER valueFrom: secretKeyRef: name: plausible-config key: POSTGRES_USER - name: POSTGRES_PASSWORD valueFrom: secretKeyRef: name: plausible-config key: POSTGRES_PASSWORD - name: POSTGRES_DB valueFrom: secretKeyRef: name: plausible-config key: POSTGRES_DB - name: PGDATA value: /var/lib/postgresql/data/pgdata # Use a subdirectory for PostgreSQL data volumeMounts: - mountPath: /var/lib/postgresql/data name: postgres-data volumes: - name: postgres-data persistentVolumeClaim: claimName: postgres-pvc Clickhouse deployment Plausible Analytics uses ClickHouse as its primary database for storing and querying analytics data. ClickHouse is a columnar database management system known for its high performance and efficiency in handling large volumes of data. It is optimized for read-heavy operations, making it ideal for real-time analytics and reporting. By leveraging ClickHouse, Plausible can provide fast and accurate insights into website traffic and user behavior, ensuring a smooth and responsive experience for its users.\napiVersion: apps/v1 kind: Deployment metadata: name: plausible-clickhouse namespace: plausible spec: replicas: 1 selector: matchLabels: app: plausible-clickhouse template: metadata: labels: app: plausible-clickhouse spec: containers: - name: clickhouse image: clickhouse/clickhouse-server:24.3.3.102-alpine ports: - containerPort: 8123 volumeMounts: - mountPath: /var/lib/clickhouse name: clickhouse-data volumes: - name: clickhouse-data persistentVolumeClaim: claimName: clickhouse-pvc Simple Mail Server apiVersion: apps/v1 kind: Deployment metadata: name: plausible-mail namespace: plausible spec: replicas: 1 selector: matchLabels: app: plausible-mail template: metadata: labels: app: plausible-mail spec: containers: - name: mail image: bytemark/smtp ports: - containerPort: 25 The Plausible Application Deployment apiVersion: apps/v1 kind: Deployment metadata: name: plausible namespace: plausible spec: replicas: 1 selector: matchLabels: app: plausible template: metadata: labels: app: plausible spec: initContainers: - name: wait-for-postgresql image: busybox command: ['sh', '-c', 'until nc -z plausible-postgresql 5432; do echo \"Waiting for PostgreSQL...\"; sleep 2; done'] containers: - name: plausible image: ghcr.io/plausible/community-edition:v2.1.4 command: [\"/bin/sh\", \"-c\", \"/entrypoint.sh db createdb \u0026\u0026 /entrypoint.sh db migrate \u0026\u0026 /entrypoint.sh run\"] ports: - containerPort: 8000 envFrom: - secretRef: name: plausible-config - configMapRef: name: plausible-configmap Services for Postgres, Clickhouse, Plausible and Mail apiVersion: v1 kind: Service metadata: name: plausible-postgresql namespace: plausible spec: ports: - port: 5432 targetPort: 5432 selector: app: plausible-postgresql --- apiVersion: v1 kind: Service metadata: name: plausible-clickhouse namespace: plausible spec: ports: - port: 8123 targetPort: 8123 selector: app: plausible-clickhouse --- apiVersion: v1 kind: Service metadata: name: plausible-mail namespace: plausible spec: ports: - port: 25 targetPort: 25 selector: app: plausible-mail --- apiVersion: v1 kind: Service metadata: name: plausible namespace: plausible spec: ports: - port: 80 targetPort: 8000 selector: app: plausible Ingress Lastly we can deploy the ingress. As you will see we have commented out the production issuer until the domain is ready.\napiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: plausible-ingress namespace: plausible annotations: # cert-manager.io/cluster-issuer: letsencrypt-production cert-manager.io/cluster-issuer: letsencrypt-staging traefik.ingress.kubernetes.io/redirect-entry-point: https spec: rules: - host: YOUR_DOMAIN http: paths: - path: / pathType: Prefix backend: service: name: plausible port: number: 80 tls: - hosts: - YOUR_DOMAIN secretName: plausible-tls ","wordCount":"826","inLanguage":"en","datePublished":"2025-01-22T00:00:00Z","dateModified":"2025-01-22T00:00:00Z","author":{"@type":"Person","name":"Keith Hubner"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.keithhubner.com/posts/deploying-plausible-civo/"},"publisher":{"@type":"Organization","name":"Keith Hubner","logo":{"@type":"ImageObject","url":"https://www.keithhubner.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.keithhubner.com/ accesskey=h title="Keith Hubner (Alt + H)">Keith Hubner</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.keithhubner.com/ title=Home><span>Home</span></a></li><li><a href=https://www.keithhubner.com/about/ title="About Me"><span>About Me</span></a></li><li><a href=https://www.keithhubner.com/posts/ title=Blog><span>Blog</span></a></li><li><a href=https://www.keithhubner.com/contact/ title=Contact><span>Contact</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Deploying Plausible to Civo NEW</h1><div class=post-meta><span title='2025-01-22 00:00:00 +0000 UTC'>January 22, 2025</span>&nbsp;·&nbsp;Keith Hubner</div></header><div class=post-content><p>Create Cluster:</p><blockquote><p>You can specify a name for the cluster after the create command or leave this blank and one will be generated for you.</p></blockquote><blockquote><p>Please amend the node number and size to suit your requirements.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>civo k8s create my-cluster --nodes<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> --size<span style=color:#f92672>=</span>g4s.kube.medium --wait --save --merge
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>civo k8s create --nodes<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> --size<span style=color:#f92672>=</span>g4s.kube.medium --wait --save --merge
</span></span></code></pre></div><p>Create namespace</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create namespace plausible
</span></span></code></pre></div><p>Verify</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get nodes
</span></span></code></pre></div><p>Cert Manager:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo add jetstack https://charts.jetstack.io
</span></span><span style=display:flex><span>helm repo update
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install cert-manager jetstack/cert-manager <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --namespace cert-manager <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --create-namespace <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --set installCRDs<span style=color:#f92672>=</span>true
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pods --namespace cert-manager
</span></span></code></pre></div><p>Issuers for staging and prod:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>cert-manager.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterIssuer</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>letsencrypt-staging</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>acme</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>email</span>: <span style=color:#ae81ff>your-email@example.com</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span>: <span style=color:#ae81ff>https://acme-staging-v02.api.letsencrypt.org/directory</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>privateKeySecretRef</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>letsencrypt-staging-key</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>solvers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>http01</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ingress</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>class</span>: <span style=color:#ae81ff>traefik</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>cert-manager.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ClusterIssuer</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>letsencrypt-production</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>acme</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># Change this to your email address</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>email</span>: <span style=color:#ae81ff>your-email@example.com</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span>: <span style=color:#ae81ff>https://acme-v02.api.letsencrypt.org/directory</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>privateKeySecretRef</span>:
</span></span><span style=display:flex><span>      <span style=color:#75715e># Secret used to store the account&#39;s private key</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>letsencrypt-production-key</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>solvers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>http01</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ingress</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>class</span>: <span style=color:#ae81ff>traefik</span>
</span></span><span style=display:flex><span>          
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f issuer.yaml
</span></span></code></pre></div><h2 id=deployment>Deployment<a hidden class=anchor aria-hidden=true href=#deployment>#</a></h2><h3 id=namespace>Namespace<a hidden class=anchor aria-hidden=true href=#namespace>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Namespace</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>plausible</span>
</span></span></code></pre></div><h3 id=secret>Secret<a hidden class=anchor aria-hidden=true href=#secret>#</a></h3><p>As you can see below, some examples are given, you will need to replace these with your own values. Ensure these are base64 encoded.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Secret</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>plausible-config</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>plausible</span>
</span></span><span style=display:flex><span><span style=color:#f92672>type</span>: <span style=color:#ae81ff>Opaque</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>POSTGRES_USER</span>: <span style=color:#ae81ff>cGxhdXNpYmxl</span> <span style=color:#75715e># base64 of &#34;plausible&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>POSTGRES_PASSWORD</span>: <span style=color:#ae81ff>cGxhdXNpYmxlX3Bhc3N3b3Jk</span> <span style=color:#75715e># base64 of &#34;plausible_password&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>POSTGRES_DB</span>: <span style=color:#ae81ff>cGxhdXNpYmxlX2Ri</span> <span style=color:#75715e># base64 of &#34;plausible_db&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>DATABASE_URL</span>: <span style=color:#ae81ff>cG9zdGdyZXM6Ly9wbGF1c2libGU6cGxhdXNpYmxlX3Bhc3N3b3JkQHBsYXVzaWJsZS1wb3N0Z3Jlc3FsOjU0MzIvcGxhdXNpYmxlX2Ri</span> <span style=color:#75715e># base64 of &#34;postgres://plausible:plausible_password@plausible-postgres:5432/plausible_db&#34;</span>
</span></span></code></pre></div><h3 id=configmap>ConfigMap<a hidden class=anchor aria-hidden=true href=#configmap>#</a></h3><p>Next we create the config map with the relevant values, again replace with your domain etc. You will need to generate a random SECRET_KEY_BASE, which you can do by:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>openssl rand -base64 <span style=color:#ae81ff>48</span>
</span></span></code></pre></div><p>Use the generated value and your domain value below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ConfigMap</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>plausible-configmap</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>plausible</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>BASE_URL</span>: <span style=color:#e6db74>&#34;https://YOUR_DOMAIN&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>SECRET_KEY_BASE</span>: <span style=color:#e6db74>&#34;GENERATED KEY&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>CLICKHOUSE_DATABASE_URL</span>: <span style=color:#e6db74>&#34;http://plausible-clickhouse:8123/plausible_events_db&#34;</span>
</span></span></code></pre></div><h3 id=creating-pvcs>Creating PVCs<a hidden class=anchor aria-hidden=true href=#creating-pvcs>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>PersistentVolumeClaim</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>postgres-pvc</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>plausible</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>accessModes</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>ReadWriteOnce</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>storage</span>: <span style=color:#ae81ff>10Gi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>PersistentVolumeClaim</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>clickhouse-pvc</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>plausible</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>accessModes</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>ReadWriteOnce</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>storage</span>: <span style=color:#ae81ff>10Gi</span>
</span></span></code></pre></div><h3 id=postgres>Postgres<a hidden class=anchor aria-hidden=true href=#postgres>#</a></h3><p>You can of course use an external postgres database, for example a Civo managed db, but for this example we will deploy a database pod.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>plausible-postgresql</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>plausible</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>plausible-postgresql</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>plausible-postgresql</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>postgresql</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>postgres:14</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>5432</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>POSTGRES_USER</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>valueFrom</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>secretKeyRef</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>plausible-config</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>key</span>: <span style=color:#ae81ff>POSTGRES_USER</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>POSTGRES_PASSWORD</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>valueFrom</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>secretKeyRef</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>plausible-config</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>key</span>: <span style=color:#ae81ff>POSTGRES_PASSWORD</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>POSTGRES_DB</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>valueFrom</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>secretKeyRef</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>name</span>: <span style=color:#ae81ff>plausible-config</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>key</span>: <span style=color:#ae81ff>POSTGRES_DB</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>PGDATA</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>value</span>: <span style=color:#ae81ff>/var/lib/postgresql/data/pgdata</span> <span style=color:#75715e># Use a subdirectory for PostgreSQL data</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/var/lib/postgresql/data</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>postgres-data</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>postgres-data</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>persistentVolumeClaim</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>claimName</span>: <span style=color:#ae81ff>postgres-pvc</span>
</span></span></code></pre></div><h3 id=clickhouse-deployment>Clickhouse deployment<a hidden class=anchor aria-hidden=true href=#clickhouse-deployment>#</a></h3><p>Plausible Analytics uses ClickHouse as its primary database for storing and querying analytics data. ClickHouse is a columnar database management system known for its high performance and efficiency in handling large volumes of data. It is optimized for read-heavy operations, making it ideal for real-time analytics and reporting. By leveraging ClickHouse, Plausible can provide fast and accurate insights into website traffic and user behavior, ensuring a smooth and responsive experience for its users.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>plausible-clickhouse</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>plausible</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>plausible-clickhouse</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>plausible-clickhouse</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>clickhouse</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>clickhouse/clickhouse-server:24.3.3.102-alpine</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>8123</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/var/lib/clickhouse</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>clickhouse-data</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>clickhouse-data</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>persistentVolumeClaim</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>claimName</span>: <span style=color:#ae81ff>clickhouse-pvc</span>
</span></span></code></pre></div><h3 id=simple-mail-server>Simple Mail Server<a hidden class=anchor aria-hidden=true href=#simple-mail-server>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>plausible-mail</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>plausible</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>plausible-mail</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>plausible-mail</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>mail</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>bytemark/smtp</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>25</span>
</span></span></code></pre></div><h3 id=the-plausible-application-deployment>The Plausible Application Deployment<a hidden class=anchor aria-hidden=true href=#the-plausible-application-deployment>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>apps/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>plausible</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>plausible</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>replicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>matchLabels</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>app</span>: <span style=color:#ae81ff>plausible</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>app</span>: <span style=color:#ae81ff>plausible</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>initContainers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>wait-for-postgresql</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>busybox</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: [<span style=color:#e6db74>&#39;sh&#39;</span>, <span style=color:#e6db74>&#39;-c&#39;</span>, <span style=color:#e6db74>&#39;until nc -z plausible-postgresql 5432; do echo &#34;Waiting for PostgreSQL...&#34;; sleep 2; done&#39;</span>]
</span></span><span style=display:flex><span>      <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>plausible</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ghcr.io/plausible/community-edition:v2.1.4</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: [<span style=color:#e6db74>&#34;/bin/sh&#34;</span>, <span style=color:#e6db74>&#34;-c&#34;</span>, <span style=color:#e6db74>&#34;/entrypoint.sh db createdb &amp;&amp; /entrypoint.sh db migrate &amp;&amp; /entrypoint.sh run&#34;</span>]
</span></span><span style=display:flex><span>        <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>8000</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>envFrom</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>secretRef</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>name</span>: <span style=color:#ae81ff>plausible-config</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>configMapRef</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>name</span>: <span style=color:#ae81ff>plausible-configmap</span>
</span></span></code></pre></div><h3 id=services-for-postgres-clickhouse-plausible-and-mail>Services for Postgres, Clickhouse, Plausible and Mail<a hidden class=anchor aria-hidden=true href=#services-for-postgres-clickhouse-plausible-and-mail>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>plausible-postgresql</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>plausible</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>5432</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>5432</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>plausible-postgresql</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>plausible-clickhouse</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>plausible</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>8123</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>8123</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>plausible-clickhouse</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>plausible-mail</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>plausible</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>25</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>25</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>plausible-mail</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>plausible</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>plausible</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>port</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>8000</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>plausible</span>
</span></span></code></pre></div><h3 id=ingress>Ingress<a hidden class=anchor aria-hidden=true href=#ingress>#</a></h3><p>Lastly we can deploy the ingress. As you will see we have commented out the production issuer until the domain is ready.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>networking.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Ingress</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>plausible-ingress</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>plausible</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># cert-manager.io/cluster-issuer: letsencrypt-production</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>cert-manager.io/cluster-issuer</span>: <span style=color:#ae81ff>letsencrypt-staging</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>traefik.ingress.kubernetes.io/redirect-entry-point</span>: <span style=color:#ae81ff>https</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>host</span>: <span style=color:#ae81ff>YOUR_DOMAIN</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>http</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>paths</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>pathType</span>: <span style=color:#ae81ff>Prefix</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>backend</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>name</span>: <span style=color:#ae81ff>plausible</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>port</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>number</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>tls</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>YOUR_DOMAIN</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>secretName</span>: <span style=color:#ae81ff>plausible-tls</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.keithhubner.com/tags/civo/>Civo</a></li><li><a href=https://www.keithhubner.com/tags/kubernetes/>Kubernetes</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://www.keithhubner.com/>Keith Hubner</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span><p>Get in touch:</p><ul><li><a href=mailto:yourname@example.com>Email</a></li><li><a href=https://linkedin.com/in/yourprofile>LinkedIn</a></li><li><a href=https://github.com/yourusername>GitHub</a></li></ul></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>