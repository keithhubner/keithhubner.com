<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Keith Hubner</title>
<meta name="keywords" content="">
<meta name="description" content="Deploying Plausible Analytics on a Kubernetes cluster can significantly enhance your ability to manage and scale your analytics infrastructure. This guide will walk you through the process of deploying Plausible on Civo Kubernetes, leveraging various Kubernetes resources and tools to ensure a smooth and efficient setup.
Table of Contents

Encode the values in base64
Create the secret.yaml file with the encoded values

ConfigMap
Creating PVCs
Clickhouse DeploymentmName: clickhouse-pvc
The Plausible Application DeploymentetRef:
Additional Recommendations and Insights

Choosing Civo Node SizesThe node size g4s.kube.medium specified in the cluster creation is suitable for most small to medium workloads. However, if you anticipate higher traffic or need more processing power, you can explore other Civo node sizes. Ensure your cluster has sufficient resources to handle database workloads and analytics processing.
Using Managed Databases
Traefik Configuration
Securing Secrets
Monitoring and Logging
Backups and Disaster Recovery
Testing and Staging Environment





Prerequisites
Before you begin, ensure you have the following:">
<meta name="author" content="Keith Hubner">
<link rel="canonical" href="http://localhost:1313/posts/deploying-plausible-civo-updated/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css" integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/deploying-plausible-civo-updated/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Keith Hubner (Alt + H)">Keith Hubner</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="About Me">
                    <span>About Me</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/posts/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/contact/" title="Contact">
                    <span>Contact</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      
    </h1>
    <div class="post-meta">Keith Hubner

</div>
  </header> 
  <div class="post-content"><p>Deploying Plausible Analytics on a Kubernetes cluster can significantly enhance your ability to manage and scale your analytics infrastructure. This guide will walk you through the process of deploying Plausible on Civo Kubernetes, leveraging various Kubernetes resources and tools to ensure a smooth and efficient setup.</p>
<h3 id="table-of-contents">Table of Contents<a hidden class="anchor" aria-hidden="true" href="#table-of-contents">#</a></h3>
<ul>
<li><a href="#encode-the-values-in-base64">Encode the values in base64</a></li>
<li><a href="#create-the-secretyaml-file-with-the-encoded-values">Create the secret.yaml file with the encoded values</a>
<ul>
<li><a href="#configmap">ConfigMap</a></li>
<li><a href="#creating-pvcs">Creating PVCs</a></li>
<li><a href="#clickhouse-deploymentmname-clickhouse-pvc">Clickhouse DeploymentmName: clickhouse-pvc</a></li>
<li><a href="#the-plausible-application-deploymentetref">The Plausible Application DeploymentetRef:</a></li>
<li><a href="#additional-recommendations-and-insights">Additional Recommendations and Insights</a>
<ul>
<li><a href="#choosing-civo-node-sizesthe-node-size-g4skubemedium-specified-in-the-cluster-creation-is-suitable-for-most-small-to-medium-workloads-however-if-you-anticipate-higher-traffic-or-need-more-processing-power-you-can-explore-other-civo-node-sizes-ensure-your-cluster-has-sufficient-resources-to-handle-database-workloads-and-analytics-processing">Choosing Civo Node SizesThe node size <code>g4s.kube.medium</code> specified in the cluster creation is suitable for most small to medium workloads. However, if you anticipate higher traffic or need more processing power, you can explore other Civo node sizes. Ensure your cluster has sufficient resources to handle database workloads and analytics processing.</a></li>
<li><a href="#using-managed-databases">Using Managed Databases</a></li>
<li><a href="#traefik-configuration">Traefik Configuration</a></li>
<li><a href="#securing-secrets">Securing Secrets</a></li>
<li><a href="#monitoring-and-logging">Monitoring and Logging</a></li>
<li><a href="#backups-and-disaster-recovery">Backups and Disaster Recovery</a></li>
<li><a href="#testing-and-staging-environment">Testing and Staging Environment</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="prerequisites">Prerequisites<a hidden class="anchor" aria-hidden="true" href="#prerequisites">#</a></h3>
<p>Before you begin, ensure you have the following:</p>
<ul>
<li><strong>Basic Knowledge of Kubernetes</strong>: Familiarity with Kubernetes concepts such as pods, deployments, services, and namespaces.</li>
<li><strong>Civo Account</strong>: A registered account on Civo with access to create Kubernetes clusters.</li>
<li><strong>kubectl</strong>: The Kubernetes command-line tool installed and configured to interact with your Civo cluster.</li>
<li><strong>Helm</strong>: The package manager for Kubernetes installed on your local machine.</li>
<li><strong>Domain Name</strong>: A domain name for accessing your Plausible instance, with DNS records configured to point to your cluster&rsquo;s ingress controller.</li>
</ul>
<h3 id="required-tools">Required Tools<a hidden class="anchor" aria-hidden="true" href="#required-tools">#</a></h3>
<ul>
<li><strong>kubectl</strong>: For managing Kubernetes clusters. <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">Install kubectl</a></li>
<li><strong>Helm</strong>: For deploying applications on Kubernetes. <a href="https://helm.sh/docs/intro/install/">Install Helm</a></li>
<li><strong>Civo CLI</strong>: For managing Civo resources. <a href="https://www.civo.com/docs/cli">Install Civo CLI</a></li>
<li><strong>OpenSSL</strong>: For generating secure keys and secrets. <a href="https://www.openssl.org/source/">Install OpenSSL</a></li>
</ul>
<p>By the end of this guide, you will have a fully functional instance of Plausible Analytics running on your Civo Kubernetes cluster, complete with SSL certificates, database configurations, and ingress setup.</p>
<h2 id="create-cluster">Create Cluster<a hidden class="anchor" aria-hidden="true" href="#create-cluster">#</a></h2>
<p>You can specify a name for the cluster after the create command or leave this blank and one will be generated for you:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>civo k8s create my-cluster --nodes<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> --size<span style="color:#f92672">=</span>g4s.kube.medium --wait --save --merge
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>civo k8s create --nodes<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> --size<span style="color:#f92672">=</span>g4s.kube.medium --wait --save --merge
</span></span></code></pre></div><h2 id="create-namespace">Create Namespace<a hidden class="anchor" aria-hidden="true" href="#create-namespace">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl create namespace plausible
</span></span></code></pre></div><h2 id="verify">Verify<a hidden class="anchor" aria-hidden="true" href="#verify">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get nodes
</span></span></code></pre></div><h2 id="cert-manager">Cert Manager<a hidden class="anchor" aria-hidden="true" href="#cert-manager">#</a></h2>
<p>Add the Jetstack Helm repository and update it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm repo add jetstack https://charts.jetstack.io
</span></span><span style="display:flex;"><span>helm repo update
</span></span></code></pre></div><p>Install Cert Manager:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>helm install cert-manager jetstack/cert-manager <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --namespace cert-manager <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --create-namespace <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --set crds.enabled<span style="color:#f92672">=</span>true
</span></span></code></pre></div><p>Verify Cert Manager installation:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get pods --namespace cert-manager
</span></span></code></pre></div><h2 id="issuers-for-staging-and-production">Issuers for Staging and Production<a hidden class="anchor" aria-hidden="true" href="#issuers-for-staging-and-production">#</a></h2>
<p>Create issuers for staging and production:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt;EOF &gt; issuer.yaml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: cert-manager.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: ClusterIssuer
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: letsencrypt-staging
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  acme:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    email: your-email@example.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    server: https://acme-staging-v02.api.letsencrypt.org/directory
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    privateKeySecretRef:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      name: letsencrypt-staging-key
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    solvers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - http01:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ingress:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          class: traefik
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: cert-manager.io/v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: ClusterIssuer
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: letsencrypt-production
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  acme:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    email: your-email@example.com
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    server: https://acme-v02.api.letsencrypt.org/directory
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    privateKeySecretRef:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      name: letsencrypt-production-key
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    solvers:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - http01:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ingress:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          class: traefik
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><p>Apply the issuer configuration:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -f issuer.yaml
</span></span></code></pre></div><h2 id="deployment">Deployment<a hidden class="anchor" aria-hidden="true" href="#deployment">#</a></h2>
<p>The deployment has been broken down into the various resources, however there is no reason you can&rsquo;t just create a single deployment.yaml file, you can see an example of this in the github repo for this project.</p>
<p>Let&rsquo;s start by creating the directory for our files and then opening in a code editor:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>mkdir civo-plausible
</span></span><span style="display:flex;"><span>cd civo-plausible
</span></span></code></pre></div><h3 id="namespace">Namespace<a hidden class="anchor" aria-hidden="true" href="#namespace">#</a></h3>
<p>Create a file called <code>namespace.yaml</code> with the following content:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt;EOF &gt; namespace.yaml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Namespace
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: plausible
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><h3 id="secret">Secret<a hidden class="anchor" aria-hidden="true" href="#secret">#</a></h3>
<p>Replace the example values with your own:</p>
<h1 id="encode-the-values-in-base64">Encode the values in base64<a hidden class="anchor" aria-hidden="true" href="#encode-the-values-in-base64">#</a></h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>POSTGRES_USER_BASE64<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo -n <span style="color:#e6db74">&#34;POSTGRES_USER&#34;</span> | base64<span style="color:#66d9ef">)</span> 
</span></span><span style="display:flex;"><span>POSTGRES_PASSWORD_BASE64<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo -n <span style="color:#e6db74">&#34;POSTGRES_PASSWORD&#34;</span> | base64<span style="color:#66d9ef">)</span> 
</span></span><span style="display:flex;"><span>POSTGRES_DB_BASE64<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo -n <span style="color:#e6db74">&#34;POSTGRES_DB&#34;</span> | base64<span style="color:#66d9ef">)</span> 
</span></span><span style="display:flex;"><span>DATABASE_URL_BASE64<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo -n <span style="color:#e6db74">&#34;DATABASE_URL&#34;</span> | base64<span style="color:#66d9ef">)</span> 
</span></span></code></pre></div><h1 id="create-the-secretyaml-file-with-the-encoded-values">Create the secret.yaml file with the encoded values<a hidden class="anchor" aria-hidden="true" href="#create-the-secretyaml-file-with-the-encoded-values">#</a></h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt;EOF &gt; secret.yaml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: Secret
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: plausible-config
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  namespace: plausible
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">type: Opaque
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">data:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  POSTGRES_USER: $POSTGRES_USER_BASE64
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  POSTGRES_PASSWORD: $POSTGRES_PASSWORD_BASE64
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  POSTGRES_DB: $POSTGRES_DB_BASE64
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  DATABASE_URL: $DATABASE_URL_BASE64
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><h3 id="configmap">ConfigMap<a hidden class="anchor" aria-hidden="true" href="#configmap">#</a></h3>
<p>Generate a random <code>SECRET_KEY_BASE</code> and encode it in base64:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>SECRET_KEY_BASE<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>openssl rand -base64 <span style="color:#ae81ff">48</span> | base64<span style="color:#66d9ef">)</span>
</span></span></code></pre></div><p>Use the generated value and your domain:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cat <span style="color:#e6db74">&lt;&lt;EOF &gt; configmap.yaml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: v1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">kind: ConfigMap
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: plausible-configmap
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  namespace: plausible
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">data:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  BASE_URL: &#34;https://YOUR_DOMAIN&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  SECRET_KEY_BASE: &#34;$SECRET_KEY_BASE&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  CLICKHOUSE_DATABASE_URL: &#34;http://plausible-clickhouse:8123/plausible_events_db&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div><h3 id="creating-pvcs">Creating PVCs<a hidden class="anchor" aria-hidden="true" href="#creating-pvcs">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolumeClaim</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">postgres-pvc</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">plausible</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">ReadWriteOnce</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">10Gi</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PersistentVolumeClaim</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">clickhouse-pvc</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">plausible</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">accessModes</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">ReadWriteOnce</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">10Gi</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">POSTGRES_USER</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">valueFrom</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">secretKeyRef</span>:
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">```-config</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">OSTGRES_USER</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Deploy a PostgreSQL pod</span>:
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">fig</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">```yamlOSTGRES_PASSWORD</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1DB</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">plausible-postgresqlle-config</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">plausibleOSTGRES_DB</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">1</span><span style="color:#ae81ff">/data/pgdata</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">matchLabels:var/lib/postgresql/data</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">plausible-postgresql</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels:</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app: plausible-postgresqlmName</span>: <span style="color:#ae81ff">postgres-pvc</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">postgresql</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">postgres:14</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports:Deploy ClickHouse</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">5432</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">env:```yaml</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">POSTGRES_USER1</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">valueFrom:kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">secretKeyRef:a</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">name</span>: <span style="color:#ae81ff">plausible-configlickhouse</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">key</span>: <span style="color:#ae81ff">POSTGRES_USERusible</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">POSTGRES_PASSWORD</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">valueFrom</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">secretKeyRef</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">name</span>: <span style="color:#f92672">plausible-configatchLabels</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">key</span>: <span style="color:#ae81ff">POSTGRES_PASSWORDausible-clickhouse</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">POSTGRES_DB</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">valueFrom</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">secretKeyRef</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">name: plausible-config</span>: <span style="color:#ae81ff">plausible-clickhouse</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">key</span>: <span style="color:#ae81ff">POSTGRES_DB</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#f92672">PGDATAers</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">value</span>: <span style="color:#ae81ff">/var/lib/postgresql/data/pgdata</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumeMounts:mage</span>: <span style="color:#ae81ff">clickhouse/clickhouse-server:24.3.3.102-alpine</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/var/lib/postgresql/data</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">postgres-data 8123</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name: postgres-datatPath</span>: <span style="color:#ae81ff">/var/lib/clickhouse</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">persistentVolumeClaim:ta</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">claimName</span>: <span style="color:#ae81ff">postgres-pvc</span>
</span></span></code></pre></div><h3 id="clickhouse-deploymentmname-clickhouse-pvc">Clickhouse DeploymentmName: clickhouse-pvc<a hidden class="anchor" aria-hidden="true" href="#clickhouse-deploymentmname-clickhouse-pvc">#</a></h3>
<p>Deploy ClickHouse:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#f92672">apps/v1Deploy a simple mail server</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">metadata:```yaml</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">plausible-clickhouse</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace: plausiblekind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec:a</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">1ail</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">selector:usible</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">plausible-clickhouse</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata:atchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">labels:ausible-mail</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">plausible-clickhouse</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name: clickhouse</span>: <span style="color:#ae81ff">plausible-mail</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">clickhouse/clickhouse-server:24.3.3.102-alpine</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports:ers</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">8123</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">volumeMounts:mage</span>: <span style="color:#ae81ff">bytemark/smtp</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/var/lib/clickhouse</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">name: clickhouse-datarPort</span>: <span style="color:#ae81ff">25</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">clickhouse-data</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">persistentVolumeClaim:on Deployment</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">claimName</span>: <span style="color:#ae81ff">clickhouse-pvc</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">```Deploy the Plausible application</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### Simple Mail Server```yaml</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Deploy a simple mail server:kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">a</span>:
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">```yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">plausible-mail</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">plausible</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">plausible-mail</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">plausible-mail</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">mail</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">bytemark/smtp</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">25</span>
</span></span></code></pre></div><h3 id="the-plausible-application-deploymentetref">The Plausible Application DeploymentetRef:<a hidden class="anchor" aria-hidden="true" href="#the-plausible-application-deploymentetref">#</a></h3>
<p>onfig
Deploy the Plausible application:MapRef:
ausible-configmap</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment, Plausible, and Mail</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#f92672">plausibleCreate services for each component</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">plausible</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">spec:```yaml</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector:kind</span>: <span style="color:#ae81ff">Service</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels:a</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">plausibleble-postgresql</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">template:plausible</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">plausible</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec:argetPort</span>: <span style="color:#ae81ff">5432</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">initContainers:or</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">wait-for-postgresqlible-postgresql</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#39;sh&#39;</span>, <span style="color:#e6db74">&#39;-c&#39;</span>, <span style="color:#e6db74">&#39;until nc -z plausible-postgresql 5432; do echo &#34;Waiting for PostgreSQL...&#34;; sleep 2; done&#39;</span>] <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#f92672">plausibleadata</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">image</span>: <span style="color:#ae81ff">ghcr.io/plausible/community-edition:v2.1.4ble-clickhouse</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>, <span style="color:#e6db74">&#34;-c&#34;</span>, <span style="color:#e6db74">&#34;/entrypoint.sh db createdb &amp;&amp; /entrypoint.sh db migrate &amp;&amp; /entrypoint.sh run&#34;</span>]<span style="color:#ae81ff">plausible</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">8000</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">envFrom</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">secretRef:argetPort</span>: <span style="color:#ae81ff">8123</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">name</span>: <span style="color:#f92672">plausible-configor</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">configMapRef:ible-clickhouse</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">name</span>: <span style="color:#ae81ff">plausible-configmap</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">``` v1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### Services for Postgres, Clickhouse, Plausible, and Mailadata:</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">ble-mail</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">Create services for each component:plausible</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">```yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind: ServiceargetPort</span>: <span style="color:#ae81ff">25</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata:or</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">plausible-postgresqlusible-mail</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">plausible</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">port</span>: <span style="color:#f92672">5432adata</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">5432ble</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">selector:plausible</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">plausible-postgresql</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind: ServiceargetPort</span>: <span style="color:#ae81ff">8000</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata:or</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">plausible-clickhouseusible</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">plausible</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">port</span>: <span style="color:#ae81ff">8123</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetPort</span>: <span style="color:#f92672">8123Deploy the ingress. Comment out the production issuer until the domain is ready</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">plausible-clickhouse```yaml</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion: v1kind</span>: <span style="color:#ae81ff">Ingress</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#f92672">Servicea</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">plausible-mailplausible</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#f92672">plausibleions</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec:ster-issuer</span>: <span style="color:#ae81ff">letsencrypt-production</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports:uster-issuer</span>: <span style="color:#ae81ff">letsencrypt-staging</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">port: 25gress.kubernetes.io/redirect-entry-point</span>: <span style="color:#ae81ff">https</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">25</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">plausible-mail</span>
</span></span><span style="display:flex;"><span>---<span style="color:#f92672">ttp</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#f92672">v1ths</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Service</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata:athType</span>: <span style="color:#ae81ff">Prefix</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#f92672">plausibleend</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#f92672">plausiblece</span>:
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">spec:ble</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">ports:</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">port: 80er</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetPort</span>: <span style="color:#ae81ff">8000</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">plausible</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">```cretName</span>: <span style="color:#ae81ff">plausible-tls</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### Ingress</span>
</span></span><span style="display:flex;"><span> <span style="color:#ae81ff">and Insights</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Deploy the ingress. Comment out the production issuer until the domain is ready</span>:
</span></span><span style="display:flex;"><span><span style="color:#75715e">### Choosing Civo Node Sizes</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">```yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">networking.k8s.io/v1The node size `g4s.kube.medium` specified in the cluster creation is suitable for most small to medium workloads. However, if you anticipate higher traffic or need more processing power, you can explore other Civo node sizes. Ensure your cluster has sufficient resources to handle database workloads and analytics processing.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Ingress</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">metadata:### Using Managed Databases</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">plausible-ingress</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">plausibleWhile this guide demonstrates deploying PostgreSQL and ClickHouse directly in the cluster, consider using managed database services for production environments. Managed services offer automated backups, scaling, and monitoring, reducing operational overhead.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">annotations</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># cert-manager.io/cluster-issuer: letsencrypt-production### Traefik Configuration</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">cert-manager.io/cluster-issuer</span>: <span style="color:#ae81ff">letsencrypt-staging</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">traefik.ingress.kubernetes.io/redirect-entry-point</span>: <span style="color:#ae81ff">httpsTraefik is used as the ingress controller in this setup. If you have not installed Traefik in your cluster, you will need to deploy it before applying the ingress configuration. The official Traefik Helm chart provides an easy way to set it up.</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ae81ff">rules:### Securing Secrets</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">host</span>: <span style="color:#ae81ff">YOUR_DOMAIN</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">http:Secrets are stored in Kubernetes but are only base64-encoded by default. For enhanced security, consider integrating Kubernetes with a secret management tool like HashiCorp Vault or AWS Secrets Manager to encrypt and manage your secrets.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">paths</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/### Monitoring and Logging</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">pathType</span>: <span style="color:#ae81ff">Prefix</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">backend:Deploy monitoring and logging tools such as Prometheus, Grafana, and Loki. These tools help you gain insights into your cluster&#39;s performance and diagnose issues effectively.</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">service</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">name</span>: <span style="color:#ae81ff">plausible### Backups and Disaster Recovery</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">port</span>:
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">number</span>: <span style="color:#ae81ff">80Regularly back up your PostgreSQL and ClickHouse databases. Use tools like Velero for cluster backups or database-specific tools for targeted backups.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">tls</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">hosts:### Testing and Staging Environment</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">YOUR_DOMAIN</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">secretName</span>: <span style="color:#ae81ff">plausible-tlsBefore switching to production, thoroughly test your deployment in a staging environment. Use the staging Let&#39;s Encrypt issuer to avoid hitting rate limits and to test TLS configurations.</span>
</span></span></code></pre></div><hr>
<h2 id="additional-recommendations-and-insights">Additional Recommendations and Insights<a hidden class="anchor" aria-hidden="true" href="#additional-recommendations-and-insights">#</a></h2>
<p>By following the steps outlined above and implementing these additional recommendations, you can deploy a robust and reliable instance of Plausible Analytics on Civo Kubernetes. With privacy-first analytics becoming increasingly important, hosting your instance of Plausible gives you complete control over your data and infrastructure.</p>
<h3 id="choosing-civo-node-sizesthe-node-size-g4skubemedium-specified-in-the-cluster-creation-is-suitable-for-most-small-to-medium-workloads-however-if-you-anticipate-higher-traffic-or-need-more-processing-power-you-can-explore-other-civo-node-sizes-ensure-your-cluster-has-sufficient-resources-to-handle-database-workloads-and-analytics-processing">Choosing Civo Node SizesThe node size <code>g4s.kube.medium</code> specified in the cluster creation is suitable for most small to medium workloads. However, if you anticipate higher traffic or need more processing power, you can explore other Civo node sizes. Ensure your cluster has sufficient resources to handle database workloads and analytics processing.<a hidden class="anchor" aria-hidden="true" href="#choosing-civo-node-sizesthe-node-size-g4skubemedium-specified-in-the-cluster-creation-is-suitable-for-most-small-to-medium-workloads-however-if-you-anticipate-higher-traffic-or-need-more-processing-power-you-can-explore-other-civo-node-sizes-ensure-your-cluster-has-sufficient-resources-to-handle-database-workloads-and-analytics-processing">#</a></h3>
<h3 id="using-managed-databases">Using Managed Databases<a hidden class="anchor" aria-hidden="true" href="#using-managed-databases">#</a></h3>
<p>While this guide demonstrates deploying PostgreSQL and ClickHouse directly in the cluster, consider using managed database services for production environments. Managed services offer automated backups, scaling, and monitoring, reducing operational overhead.</p>
<h3 id="traefik-configuration">Traefik Configuration<a hidden class="anchor" aria-hidden="true" href="#traefik-configuration">#</a></h3>
<p>Traefik is used as the ingress controller in this setup. If you have not installed Traefik in your cluster, you will need to deploy it before applying the ingress configuration. The official Traefik Helm chart provides an easy way to set it up.</p>
<h3 id="securing-secrets">Securing Secrets<a hidden class="anchor" aria-hidden="true" href="#securing-secrets">#</a></h3>
<p>Secrets are stored in Kubernetes but are only base64-encoded by default. For enhanced security, consider integrating Kubernetes with a secret management tool like HashiCorp Vault or AWS Secrets Manager to encrypt and manage your secrets.</p>
<h3 id="monitoring-and-logging">Monitoring and Logging<a hidden class="anchor" aria-hidden="true" href="#monitoring-and-logging">#</a></h3>
<p>Deploy monitoring and logging tools such as Prometheus, Grafana, and Loki. These tools help you gain insights into your cluster&rsquo;s performance and diagnose issues effectively.</p>
<h3 id="backups-and-disaster-recovery">Backups and Disaster Recovery<a hidden class="anchor" aria-hidden="true" href="#backups-and-disaster-recovery">#</a></h3>
<p>Regularly back up your PostgreSQL and ClickHouse databases. Use tools like Velero for cluster backups or database-specific tools for targeted backups.</p>
<h3 id="testing-and-staging-environment">Testing and Staging Environment<a hidden class="anchor" aria-hidden="true" href="#testing-and-staging-environment">#</a></h3>
<p>Before switching to production, thoroughly test your deployment in a staging environment. Use the staging Let&rsquo;s Encrypt issuer to avoid hitting rate limits and to test TLS configurations.</p>
<hr>
<p>By following the steps outlined above and implementing these additional recommendations, you can deploy a robust and reliable instance of Plausible Analytics on Civo Kubernetes. With privacy-first analytics becoming increasingly important, hosting your instance of Plausible gives you complete control over your data and infrastructure.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Keith Hubner</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
    <p>Get in touch:</p>
  <ul>
    
      <li><a href="mailto:yourname@example.com">Email</a></li>
    
      <li><a href="https://linkedin.com/in/yourprofile">LinkedIn</a></li>
    
      <li><a href="https://github.com/yourusername">GitHub</a></li>
    
  </ul>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
